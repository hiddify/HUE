version: '3.8'

services:
  hue:
    build:
      context: ../..
      dockerfile: deployments/docker/Dockerfile
    container_name: hue
    restart: unless-stopped
    ports:
      - "50051:50051"  # gRPC
      - "50052:50052"  # HTTP REST API
    environment:
      - HUE_DB_URL=sqlite:///data/hue.db
      - HUE_PORT=50051
      - HUE_LOG_LEVEL=info
      - HUE_AUTH_SECRET=${HUE_AUTH_SECRET:-change-me-in-production}
      - HUE_DB_FLUSH_INTERVAL=5m
      - HUE_CONCURRENT_WINDOW=5m
      - HUE_PENALTY_DURATION=10m
      - HUE_EVENT_STORE_TYPE=db
    volumes:
      - hue-data:/data
      - ./maxmind:/data/maxmind:ro  # Optional: Mount MaxMind GeoIP database
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:50052/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  hue-data:
    driver: local
